@using DuAn2811_.Models
@using Microsoft.IdentityModel.Tokens
@using Server._2811._2004.model1
@model SanPhamViewModel

<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Chi tiết sản phẩm -</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link href="~/css/chitietsanpham.css" rel="stylesheet" asp-append-version="true" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
    <style>
        /* Kiểu dáng cơ bản cho tất cả các nút dung lượng và màu sắc */
        .capacity-button,
        .color-button {
            padding: 8px 12px;
            margin: 5px;
            border: 1px solid #ccc;
            background-color: white; /* Mặc định là màu trắng */
            cursor: pointer;
            border-radius: 5px;
            color: #333; /* Màu chữ mặc định */
        }

            /* Hiệu ứng khi di chuột qua nút */
            .capacity-button:hover,
            .color-button:hover {
                background-color: #f0f0f0; /* Màu nền nhạt hơn khi di chuột */
            }

            /* Kiểu dáng cho nút đang được chọn */
            .capacity-button.selected,
            .color-button.selected {
                border: 2px solid blue; /* Viền xanh cho nút được chọn */
                font-weight: bold;
                background-color: #d0e0ff; /* Màu nền xanh nhạt cho nút được chọn */
                color: #000; /* Màu chữ đậm hơn cho nút được chọn */
            }
    </style>
</head>
<body>
    <div class="product-detail-container">
        <div class="product-image-section">
            @if (Model?.Anh != null && Model.Anh.Any())
            {
                <img src="@Model.Anh.First()" alt="@Model.MoTa" class="product-main-image" />
                @if (Model.Anh.Count() > 1)
                {
                    <div class="product-thumbnails">
                        @foreach (var imageUrl in Model.Anh)
                        {
                            <img src="@imageUrl" alt="@Model.MoTa" class="product-thumbnail-image" data-main-image="@imageUrl" />
                        }
                    </div>
                }
            }
            else
            {
                <p>Không có ảnh</p>
            }
        </div>
        <div class="product-info-section">
            <h1 class="product-name">
                @Model?.MoTa
            </h1>
            <div class="product-status">
                @foreach (var soluong in Model.QuanLyTonKhos)
                {
                    @if(soluong.SoLuongTon > 0 || soluong.SoLuongTon != null)
                    {
                        <i class="fa fa-check-circle" style="color: green;">Còn hàng</i>

                    }
                    else
                    {
                        <i class="fa fa-check-circle" style="color: green;">hết hàng</i>
                    }
                }

            </div >


            <div class="product" data-product-id="@Model.MaSanPham">
                <div class="capacity-options">
                    <p>Chọn dung lượng:</p>
                    @if (Model.ChiTietSanPhams != null && Model.ChiTietSanPhams.Any())
                    {
                        var distinctCapacities = Model.ChiTietSanPhams.Select(ct => $"{ct.Dung_Luong}").Distinct().ToList();
                        foreach (var capacity in distinctCapacities)
                        {
                            <button type="button" class="capacity-button" data-product-id="@Model.MaSanPham" data-capacity="@capacity">
                                @capacity
                            </button>
                        }
                    }
                </div>

                <div class="color-options">
                    <p>Màu sắc:</p>
                    @if (Model?.ChiTietSanPhams != null)
                    {
                        var distinctColors = Model.ChiTietSanPhams.Select(ct => ct.Mau).Distinct().OrderBy(c => c).ToList();
                        foreach (var color in distinctColors)
                        {
                            <button type="button" class="color-button" data-product-id="@Model.MaSanPham" data-color="@color">@color</button>
                        }
                    }
                </div>

                <div class="product-price-section">
                    <span class="product-price" id="price-@Model.MaSanPham">
                        @if (Model?.ChiTietSanPhams != null && Model.ChiTietSanPhams.Any())
                        {
                            @Model.ChiTietSanPhams.First()?.Gia
                        }
                        else
                        {
                            <span>Sản phẩm không có</span>
                        }
                    </span>
                </div>

                <ul class="product-details" data-product-id="@Model.MaSanPham" style="list-style-type:none; padding:10px; display:none;">
                    @if (Model.ChiTietSanPhams != null)
                    {
                        foreach (var chitiet in Model.ChiTietSanPhams)
                        {
                            <li data-capacity="@chitiet.Dung_Luong" data-price="@chitiet.Gia" data-color="@chitiet.Mau">
                                Giá: @chitiet.Gia đ, Dung lượng: @chitiet.Dung_Luong, Màu: @chitiet.Mau
                            </li>
                        }
                    }

                    @if (Model.QuanLyTonKhos != null)
                    {
                        foreach (var tonkho in Model.QuanLyTonKhos)
                        {
                            <li>Đã bán: @tonkho.So_Luong_Da_Ban</li>
                        }
                    }

                    @if (Model.ChiTietKhuyenMais != null)
                    {
                        foreach (var ctkm in Model.ChiTietKhuyenMais)
                        {
                            <li>
                                @ctkm.TenKhuyenMai
                            </li>
                        }
                    }
                </ul>
            </div>
            
          
            <div class="product-warranty">
                Bảo hành: Chính hãng đến 03/03/2026
            </div>

            <div class="promotion-selection">
                <p class="promotion-title"><i class="fa fa-gift"></i> Khuyến mãi:</p>
                @if (Model?.ChiTietKhuyenMais != null && Model.ChiTietKhuyenMais.Any())
                {
                    <form id="promotionForm">
                        <ul class="promotion-list">
                            @foreach (var ctkm in Model.ChiTietKhuyenMais)
                            {
                                <li>
                                    <input type="radio" id="promotion_@ctkm.MaChiTietKhuyenMai" name="selectedPromotion" value="@ctkm.MaChiTietKhuyenMai" />
                                    <label for="promotion_@ctkm.MaChiTietKhuyenMai">@ctkm.MoTaKhuyenMai</label>
                                </li>
                            }
                        </ul>
                    </form>
                    <a href="#" class="view-all-promotions">Xem tất cả khuyến mãi</a>
                }
                else
                {
                    <p>Không có khuyến mãi áp dụng.</p>
                }
            </div>

            <div class="product-actions">
                <button class="add-to-cart-button"><i class="fa fa-shopping-cart"></i> Thêm vào giỏ</button>
                <button class="buy-now-button">Mua ngay</button>
            </div>

            <div class="installment-info">
                <div class="installment-item">
                    <i class="fa fa-percent"></i> Trả góp 0%<br><span class="installment-detail">Duyệt hồ sơ trong 5 phút</span>
                </div>
                <div class="installment-item">
                    <i class="fa fa-credit-card"></i> Trả chậm qua thẻ<br><span class="installment-detail">Visa, Mastercard, JCB, Amex</span>
                </div>
            </div>

            <p class="call-support"><i class="fa fa-phone"></i> Gọi đặt mua <a href="tel:0862451360">0862451360</a> (8:00 - 21:30)</p>
            <a href="#" class="view-store-availability"><i class="fa fa-store"></i> Xem siêu thị có hàng</a>
        </div>
    </div>

    <div class="product-specifications-section">
        <h2>Thông số kỹ thuật</h2>
        <hr class="section-divider">
        <div class="specification-list">
            <div class="specification-item">
                <span class="specification-name">Cấu hình & Bộ nhớ</span>
                <i class="fa fa-chevron-right"></i>
            </div>
            <div class="specification-item">
                <span class="specification-name">Camera & Màn hình</span>
                <i class="fa fa-chevron-right"></i>
            </div>
            <div class="specification-item">
                <span class="specification-name">Pin & Sạc</span>
                <i class="fa fa-chevron-right"></i>
            </div>
            <div class="specification-item">
                <span class="specification-name">Tiện ích</span>
                <i class="fa fa-chevron-right"></i>
            </div>
            <div class="specification-item">
                <span class="specification-name">Kết nối</span>
                <i class="fa fa-chevron-right"></i>
            </div>
            <div class="specification-item">
                <span class="specification-name">Thiết kế & Chất liệu</span>
                <i class="fa fa-chevron-right"></i>
            </div>
        </div>
    </div>
    <div class="rating-container">
        <h2 class="rating-title">Đánh giá Điện thoại </h2>

        <div class="overall-rating">
            <span class="star-icon-overall star"></span>
            <span class="rating-value">5</span>
            <span class="out-of">/5</span>
        </div>
        <p class="customer-satisfaction">15,2k khách hàng hài lòng <span title="Thông tin thêm">(?)</span></p>

        <div class="rating-breakdown">
            <div class="rating-bar">
                <span class="star-icon-breakdown star"></span>
                <div class="progress-bar-container">
                    <div class="progress-bar" style="width: 100%;"></div>
                </div>
                <span class="percentage">100%</span>
            </div>
            <div class="rating-bar">
                <span class="star-icon-breakdown star"></span>
                <div class="progress-bar-container">
                    <div class="progress-bar" style="width: 0%;"></div>
                </div>
                <span class="percentage">0%</span>
            </div>
            <div class="rating-bar">
                <span class="star-icon-breakdown star"></span>
                <div class="progress-bar-container">
                    <div class="progress-bar" style="width: 0%;"></div>
                </div>
                <span class="percentage">0%</span>
            </div>
            <div class="rating-bar">
                <span class="star-icon-breakdown star"></span>
                <div class="progress-bar-container">
                    <div class="progress-bar" style="width: 0%;"></div>
                </div>
                <span class="percentage">0%</span>
            </div>
            <div class="rating-bar">
                <span class="star-icon-breakdown star"></span>
                <div class="progress-bar-container">
                    <div class="progress-bar" style="width: 0%;"></div>
                </div>
                <span class="percentage">0%</span>
            </div>
        </div>

        <button class="write-review-button">Viết đánh giá</button>
    </div>
        
   <br />
    <div class="product-specifications-section">
        <h2>
            sản phẩm liên quan
        </h2>
    </div>
    @* Đảm bảo jQuery được tải trước *@
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>

    @* Khởi tạo một biến JavaScript với MaSanPham trước khi tải script của bạn *@
    <script>
        var initialProductId = '@Model.MaSanPham';
    </script>

    @* Liên kết tệp JavaScript riêng biệt của bạn SAU khi biến được khởi tạo *@
    <script src="~/js/chitietsanpham.js"></script>
</body>
</html>
    